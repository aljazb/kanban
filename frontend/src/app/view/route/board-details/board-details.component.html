<div>
  <div class="row mb-2">
    <div *ngIf="board" class="col-6">
      <h3>{{board.name}}</h3>
    </div>
    <div *ngIf="isAuthUserKanbanMaster || isOwner" class="col-6">
      <button class="btn btn-primary pull-right" routerLink="/board/{{id}}/settings">Settings</button>
      <button class="btn btn-primary pull-right mr-3" routerLink="/board/{{id}}/edit">Edit</button>
    </div>
  </div>
  <div class="row mb-2">
    <button class="btn btn-info" (click)="toggleDisplayOptions()"><span *ngIf="!showDisplayOptions">Show</span><span *ngIf="showDisplayOptions">Hide</span> Display Options</button>
  </div>
  <div *ngIf="showDisplayOptions" class="row mb-3" id="displayOptions">
    <form [formGroup]="formDisplayOptions">
      <div class="form-group row">
        <label for="in-criticalDays" class="col-md-6 col-form-label">Show Cards Due in <strong>n</strong> Days</label>
        <div class="col-md-6">
          <input type="number" name="card-criticalDays" class="form-control" id="in-criticalDays" placeholder="Critical Days"
                 formControlName="criticalDays">
        </div>
      </div>
    </form>
  </div>

  <div class="row">
    <div class="col-sm-12">

      <div class="scroll-group" *ngIf="boardRepresentation && boardRepresentation.boardPartTable">
        <div class="row">

          <table class="table table-bordered">
            <!--<thead>-->
              <tr *ngFor="let tr of boardRepresentation.boardPartTable; let i = index">

                <td class="lane-name" *ngIf="i == 0" [attr.rowspan]="boardRepresentation.maxDepth">Projects</td>

                <td class="align-top" *ngFor="let td of filterBoardPartTable(tr)" [attr.colspan]="td.colSpan" [attr.rowspan]="td.getRowSpan(getIsCollapsed(td.boardPart))"
                    [ngClass]="{
                    'over-max-wip-warning': td.boardPart.maxWip != 0 && td.boardPart.maxWip < td.currentWip,
                    'highest-priority': td.boardPart.leafNumber == board.highestPriority,
                    'dev-start': td.boardPart.leafNumber == board.startDev,
                    'dev-end': td.boardPart.leafNumber == board.endDev,
                    'acceptance-ready': td.boardPart.leafNumber == board.acceptanceTesting}">

                  <div>
                    <span *ngIf="!getIsCollapsed(td.boardPart)">
                      {{td.boardPart.name}}
                    </span>

                    {{td.getRowSpan(getIsCollapsed(td.boardPart))}} [{{td.currentWip}}/{{td.boardPart.maxWip}}]

                    <button class="btn btn-sm" (click)="toggleIsCollapsed(td.boardPart)">
                      <i *ngIf="!getIsCollapsed(td.boardPart)" class="fa fa-minus"></i>
                      <i *ngIf="getIsCollapsed(td.boardPart)" class="fa fa-plus"></i>
                    </button>
                  </div>

                  <div class="align-middle mt-3" *ngIf="getIsCollapsed(td.boardPart)">
                    <p class="vertical-text">
                      {{td.boardPart.name}}
                    </p>
                  </div>

                </td>

              </tr>
            <!--</thead>-->

            <!--<tbody>-->
              <tr *ngFor="let tr of boardRepresentation.projectTable">

                <td class="lane-name hover-pointer">
                  <a routerLink="/project/{{tr.project.id}}">
                    [{{tr.project.name}}]
                  </a>
                </td>

                <td class="align-top" *ngFor="let td of filterCardTable(tr.cardTables)">

                  <div *ngIf="getIsCollapsed(td.currentBoardPart)" class="align-top">
                    <div class="vertical-text">{{td.currentBoardPart.name}}</div>
                  </div>

                  <div *ngIf="!getIsCollapsed(td.currentBoardPart)">

                      <div class="list-group mt-1 rounded-top" *ngFor="let c of td.cards"
                           [style.background]="c.card.color" [ngClass]="{'blink-background': criticalCardIds.has(c.card.id)}">

                        <div class="list-group-item mt-3">

                          <div class="col-12">

                            <div class="dropdown pull-left">
                              <button (click)="c.showLeft = !c.showLeft" class="btn btn-sm ">
                                <i class="fa fa-caret-left"></i>
                              </button>
                              <div class="dropdown-content" [ngClass]="{ 'show': c.showLeft }">
                                <div class="hover-pointer" *ngFor="let toBp of td.leftBoardPart" (click)="moveCard(c.card, td.currentBoardPart, toBp)">{{toBp.name}}</div>
                              </div>
                            </div>

                            <a routerLink="/card/{{c.card.id}}">{{ (c.card.name.length>9)? (c.card.name | slice:0:9)+"...":(c.card.name) }}</a>
                            <span #pDown="ngbPopover" ngbPopover="All sub-tasks have to be completed in order to move the card to acceptance testing."
                                  popoverTitle="Sub-tasks uncompleted" triggers="manual" (mouseenter)="c.card.subTasks && subtaskMoveWarning(c.card) && pDown.open()" (mouseleave)="pDown.close()">
                              <div class="dropdown pull-right">
                                <button (click)="c.showRight = !c.showRight" class="btn btn-sm" [disabled]="c.card.subTasks && subtaskMoveWarning(c.card)">
                                  <i class="fa fa-caret-right"></i>
                                </button>
                                <div class="dropdown-content" [ngClass]="{ 'show': c.showRight }">
                                  <div class="hover-pointer" *ngFor="let toBp of td.rightBoardPart" (click)="moveCard(c.card, td.currentBoardPart, toBp)">{{toBp.name}}</div>
                                </div>
                              </div>
                            </span>

                          </div>

                          <div class="col-12">
                            <a class="small"><strong>Assignee: {{ c.card.assignedTo == null ? '-' : (c.card.assignedTo.email.length>15)? (c.card.assignedTo.email | slice:0:12)+"...":(c.card.assignedTo.email) }}</strong> </a>

                            <br>
                            <a class="small"><strong>Priority: {{c.card.cardType.toString().replace("_", " ")}}</strong></a>
                          </div>

                        </div>

                        <div class="list-group" *ngIf="c.card.subTasks">
                          <div *ngFor="let t of c.card.subTasks" class="list-group-item list-group-item-action">
                            <input style="float:left; width:20%" type="checkbox" name="subtask-completed" id="in-completed"
                                   [disabled]="!isAuthUserDeveloper && !isAuthUserKanbanMaster" [checked]="t.completed" (click)="updateCompleted(t)">
                            <p style="float:left; align-content: left; width:30%"><strong>{{t.name}}</strong> </p>
                            <p *ngIf="t.workingHours" style="float:right; width:30%">[{{t.workingHours}} h]</p>

                          </div>
                        </div>

                        <button type="button" class="btn btn-sm btn-danger pull-right mt-0"
                                (click)="rejectCard(c.card, td.currentBoardPart, td.moveBack)" *ngIf="td.moveBack">

                          <i class="fa fa-arrow-circle-left fa-1x"> Reject
                            <a placement="bottom" ngbPopover="with this button you can reject this card and send it back infront of Development phase" triggers="mouseenter:mouseleave"
                               (click)="$event.stopPropagation()">
                              <i class="fa fa-question-circle"></i>
                            </a>

                          </i>
                        </button>


                      </div>

                </div>
                </td>

              </tr>
            <!--</tbody>-->

          </table>

        </div>
      </div>

    </div>
  </div>

</div>
